<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" >
	<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" /> 
	<meta http-equiv="Pragma" content="no-cache" /> 
	<meta http-equiv="Expires" content="0" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<title>Fil De Soi 1</title>

	<link href="node_modules/@grame/inscorejs/fonts/fonts.css" rel="stylesheet">
	<script src="node_modules/@grame/inscorejs/libINScore.js"></script>
	<script src="node_modules/@grame/inscorejs/INScoreJS.js"></script>
	<script src="node_modules/@grame/libfaust/libfaust-wasm.js"></script>
	<script src="node_modules/@grame/libfaust/FaustLibrary.js"></script>	
	<style>
	body { margin: 10; background: white; }
	.inscore { width: 100%; height: 100%; font-size: 1px; }
	.section {
        display: flex;
        flex-flow: column;
        background-color: rgba(0, 0, 0, 0.7);
		overflow-y: scroll;
        width: 30vw;
        padding: 1rem;
		color: rgba(255, 255, 255, 0.829);
    }
	th {
		border: 1px solid white;
	}
	table {
		color: rgba(255, 255, 255, 0.829);
		width: 100%;
		padding-left: 1vw;
		padding-right: 1vw;
	}
	</style>
	<script>
		var currentSection = 0;
		function nextSection() {
			currentSection += 1;
			if (currentSection > 4) {
				currentSection = 1;
			}
			return("/ITL/scene/faust event SECTION" + currentSection +";");
		}

		function toSection(section) {
			currentSection = section;
			return ("/ITL/scene/faust event SECTION" + currentSection + ";");
		}
	</script>
</head>

<body>

<div class="inscore" id="scene">
	/ITL/scene/wait set txt "Loading..."; 
	
	/ITL connect  "http://localhost:8081";

	<!-- /ITL/scene/faust set faustf "./rsrc/FilDeSoi1PanStereo.dsp.txt"; -->
	/ITL/scene/faust set faust 'process =  _,_ ;';
	/ITL/scene/faust scale 0.2;
	/ITL/scene/faust show 0;
	/ITL/scene/faust connect audioOutput;
	
	/ITL/scene/wait del;
	
	/ITL/scene/score set img "./rsrc/FilDeSoi1.png";
	/ITL/scene/cursor set rect 0.01 0.1;
	/ITL load "src/score.inscore.txt";
	
	/ITL load "src/btnControl.inscore.txt";
	/ITL load "src/faustSections.inscore.txt";
	/ITL load "src/help.inscore.txt";

	/ITL/scene/score watch mouseDown (
		/ITL/scene/cursor date '$date',
		/ITL/scene/audio vdate '$date'
	);

	/ITL/scene/score watch mouseMove (
		/ITL/scene/cursor date '$date',
		/ITL/scene/audio vdate '$date'
	);

	/ITL/scene/controlPanel set rect 0.6 0.2;
	/ITL/scene/controlPanel/audioCtrltxtbtnWavOnly 		    set txt "Playback to audio output";
	/ITL/scene/controlPanel/audioCtrltxtbtnWavToDSP 		set txt "Playback to DSP";
	/ITL/scene/controlPanel/audioCtrltxtbtnAudioInToDSP 	set txt "Audio input to DSP";
	/ITL/scene/controlPanel/audioCtrlbtnWavOnly 			set rect 0.4 0.4;
	/ITL/scene/controlPanel/audioCtrlbtnWavToDSP 			set rect 0.4 0.4;
	/ITL/scene/controlPanel/audioCtrlbtnAudioInToDSP 		set rect 0.4 0.4;
	/ITL load "src/controlPanel.inscore.txt";

	toggleWavOnly = (
		/ITL/scene/controlPanel/$self push,
		/ITL/scene/controlPanel/audioCtrlbtnWavOnly color white,
		/ITL/scene/audio disconnect audioOutput,
		/ITL/scene/controlPanel/audioCtrlbtnWavOnly watch mouseDown (
			/ITL/scene/controlPanel/audioCtrlbtnWavOnly color green,
			/ITL/scene/audio connect audioOutput,			
			/ITL/scene/controlPanel/$self pop
		)
	);

	toggleWavToDSP = (
		/ITL/scene/controlPanel/$self push,
		/ITL/scene/controlPanel/audioCtrlbtnWavToDSP color green,
		/ITL/scene/audio connect faust,	
		/ITL/scene/controlPanel/audioCtrlbtnWavToDSP watch mouseDown (
			/ITL/scene/controlPanel/audioCtrlbtnWavToDSP color white,			
			/ITL/scene/audio disconnect faust,
			/ITL/scene/controlPanel/$self pop
		)
	);

	toggleAudioInToDSP = (
		/ITL/scene/controlPanel/$self push,
		/ITL/scene/controlPanel/audioCtrlbtnAudioInToDSP color green,
		/ITL/scene/audioInput connect faust,		
		/ITL/scene/controlPanel/audioCtrlbtnAudioInToDSP watch mouseDown (
			/ITL/scene/controlPanel/audioCtrlbtnAudioInToDSP color white,
			/ITL/scene/audioInput disconnect faust,	
			/ITL/scene/controlPanel/$self pop
		)
	);

	/ITL/scene/controlPanel/audioCtrlbtnWavOnly 		watch mouseDown $toggleWavOnly;
	/ITL/scene/controlPanel/audioCtrlbtnWavToDSP 		watch mouseDown $toggleWavToDSP;
	/ITL/scene/controlPanel/audioCtrlbtnAudioInToDSP 	watch mouseDown $toggleAudioInToDSP;

	
	<!-- Events -->
	/ITL/scene/cursor watch keyDown "1" (
		/ITL/scene/javascript run "toSection(1)"
	);

	/ITL/scene/cursor watch keyDown "2" (
		/ITL/scene/javascript run "toSection(2)"
	);

	/ITL/scene/cursor watch keyDown "3" (
		/ITL/scene/javascript run "toSection(3)"
	);

	/ITL/scene/cursor watch keyDown "4" (
		/ITL/scene/javascript run "toSection(4)"
	);

	/ITL/scene/cursor watch keyDown "5" (
		/ITL/scene/javascript run "nextSection()"
	);

	/ITL/scene/cursor watch timeEnter 9 15 (
		/ITL/scene/javascript run "toSection(2)"
	);

	/ITL/scene/cursor watch timeEnter 15 22 (
		/ITL/scene/javascript run "toSection(3)"
	);

	/ITL/scene/cursor watch timeEnter 22 30 (
		/ITL/scene/javascript run "toSection(4)"
	);

	/ITL/scene/cursor watch timeEnter 30 1000 (
		/ITL/scene event STOP
	);
</div>
</body>
</html>